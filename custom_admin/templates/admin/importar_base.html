{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<div class="content" style="max-width: 720px; margin-top: 24px;">

  <h1 style="margin-bottom: 6px;">{{ titulo_pagina }}</h1>

  {# Mensagens do framework (success/warning/error) com classes do admin #}
  {% if messages %}
    <ul class="messagelist">
      {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
          {{ message|safe }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {# Lista de erros por linha (quando a view envia "mensagens_extra") #}
  {% if mensagens_extra and mensagens_extra|length %}
    <div class="module aligned" style="margin: 12px 0 18px;">
      <h2 style="margin: 0 0 8px;">Linhas com erro ({{ mensagens_extra|length }})</h2>
      <ul class="errorlist">
        {% for m in mensagens_extra %}
          <li>{{ m }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <style>
    .import-link {
      display: inline-block;
      margin: 4px 0 16px;
      font-weight: 600;
      color: #064e08;
      font-size: 14px;
      text-decoration: none;
    }
    .import-link:hover { text-decoration: underline; }

    .info-formatos {
      color: #444;
      font-size: 12.5px;
      margin-top: 6px;
      margin-bottom: 18px;
    }
    #nome-arquivo {
      margin-top: 6px;
      color: #064e08;
      font-weight: 600;
      font-size: 13.5px;
      word-break: break-all;
    }
    .form-group { margin-bottom: 18px; }
  </style>

  {% if link_planilha %}
    <a href="{{ link_planilha }}" download class="import-link">
      ðŸ“„ Baixar modelo de planilha (.xlsx)
    </a>
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="module aligned" style="padding: 16px;">
    {% csrf_token %}

    <div class="form-group">
      <label for="id_arquivo"><strong>Selecionar arquivo</strong></label><br>
      <input type="file" name="arquivo" id="id_arquivo" accept=".csv,.xls,.xlsx"
             required onchange="mostrarNomeArquivo(this)">
      <div id="nome-arquivo"></div>
      <div class="info-formatos">Formatos aceitos: .csv, .xls, .xlsx</div>
    </div>

    <div>
      <button type="submit" class="button default">Importar</button>
    </div>
  </form>

  <script>
    function mostrarNomeArquivo(input) {
      var nome = (input.files && input.files.length) ? input.files[0].name : "";
      document.getElementById("nome-arquivo").innerText = nome;
    }
  </script>
</div>
{% endblock %}
